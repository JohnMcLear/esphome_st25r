esphome:
  name: st25r-local-test
  on_boot:
    priority: 600
    then:
      - logger.log: "DEVICE_STARTING"
      - delay: 5s
      - logger.log: "BOOT_SIGNAL"

esp32:
  board: esp32-c6-devkitc-1
  variant: esp32c6
  framework:
    type: esp-idf

logger:
#  level: VERY_VERBOSE
#  hardware_uart: USB_SERIAL_JTAG

external_components:
  - source:
      type: local
      path: components
    components: [st25r, st25r_spi, st25r_i2c]

spi:
  clk_pin: GPIO19
  miso_pin: GPIO10
  mosi_pin: GPIO18

st25r_spi:
  id: my_st25r
  cs_pin: GPIO6
  irq_pin: GPIO7
  rf_power: 15
  update_interval: 1s
  status:
    name: "ST25R Health"
  field_strength:
    name: "ST25R Field Strength"
  on_tag:
    then:
      - logger.log:
          format: "Tag detected: %s"
          args: ['x.c_str()']
      - light.turn_on: tag_led
  on_tag_removed:
    then:
      - logger.log:
          format: "Tag removed: %s"
          args: ['x.c_str()']
      - light.turn_off: tag_led

output:
  - platform: gpio
    pin: GPIO2
    id: led_output

light:
  - platform: binary
    name: "Tag LED"
    id: tag_led
    output: led_output

binary_sensor:
  - platform: template
    name: "Tag Present"
    lambda: |-
      return id(my_st25r)->is_tag_present();
